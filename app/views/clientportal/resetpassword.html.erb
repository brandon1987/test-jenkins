<% content_for :page_specific_headers do %>
	<link rel="stylesheet" type="text/css" href="/assets/login.css">
<% end %>

<header class="login-header">
	<span class="product-name">Construction Manager</span>
	<br>
	<span class="company-name">by JNC Solutions Ltd.</span>
</header>

<section class="login-page-section">
  <% if InviteCode.where(:invite_code => params[:request]).count!=0 %>
  	Please enter your new password below to continue.
  <% else %>
  	Sorry. This reset request could not be matched please check you have copied the address in its entirety.
  <% end %>
</section>

<section class="login-page-section sign-up-box">

  <% if InviteCode.where(:invite_code => params[:request]).count!=0 %>
	  <form class="stacked-form" onsubmit="return false;">
	  	<label for="username">New Password</label>
	    <input type="password" name="password" id="password" placeholder="Password">
		<label for="username">Re-enter Password</label>	    
	    <input type="password" name="reenterpassword" id="reenterpassword" placeholder="Re-enter Password">

	    <button id="password-reset-button" onclick="return false;">Reset Password</button>
	  </form>
  <% else %>

  <% end %>	


  <div id="password-reset-response" class="notice-span" style="text-align: center; display: none;">A password reset link has been sent to <span id="recipient"></span></div>
</section>

<script>
$(function() {
  $('#password-reset-button').click(sendPasswordReset);
});

function sendPasswordReset() {
	if($("#pasword").val()==$("#reenterpassword").val()){
		var button = $(this);
		button.setButtonActive();
		$.ajax({
			type: 'POST',
			url: '/clientportal/resetpassword_process',
			data: {
				password: $("#password").val(),
				reenterpassword: $("#reenterpassword").val(),
				request: "<%=params[:request]%>"
			},
			success: function(response) {
				if(response!="ok"){
					button.setButtonFailed();
				}else{
					button.setButtonSucceeded();
					swal({title:"Password Reset",
						text: "Your password has been reset, you will now be returned to the Clientportal login page.",
						 type:"success",
						 closeOnConfirm: false
					 },	 function (isconfirm){
						 	window.location.href="/clientportal";
					 });
				}
			}
		});		
	}else{
		swal({
		  title: "Problem",
		  text: "Your passwords do not match, please check and try again.",
		  type: "error",
		  confirmButtonText: "Ok"
		});		

	}

}
</script>